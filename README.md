# DeliverableEstimate Pro

🤖 AI駆動成果物見積もり自動化システム

## 📋 概要

DeliverableEstimate Proは、Excel形式の成果物リストとシステム要件から、AI Multi-Agentシステムにより工数と金額を自動算出し、構造化された見積書を生成するシステムです。

### 🎯 主な機能

- **5エージェントシステム**: 入力処理・成果物分析・工数見積・質問生成・レポート生成
- **LangGraphオーケストレーション**: 複雑なワークフローの状態管理
- **Human-in-the-Loop**: ユーザー承認・フィードバック・動的質問応答
- **Excel出力**: 見積前提条件付きの構造化見積書

### 🚀 差別化ポイント

- **動的質問生成**: 見積精度向上のための自動質問
- **見積前提条件**: 構造化された前提条件記載
- **多言語対応**: 日本語・英語のExcelヘッダー
- **実用的価値**: 実際のビジネス課題解決

## 🛠️ システム要件

- Python 3.8以上
- OpenAI API キー
- 必要なPythonパッケージ（requirements.txtを参照）

## 📦 インストール

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. 環境設定ファイルの作成

```bash
cp .env.example .env
```

### 3. .envファイルの設定

```env
# OpenAI API Configuration
OPENAI_API_KEY=sk-your-openai-api-key-here

# Financial Configuration
DAILY_RATE=50000
TAX_RATE=0.10
CURRENCY=JPY

# Language Configuration
LANGUAGE=ja

# AI Model Configuration
MODEL=gpt-4o-mini

# Default Technical Assumptions
DEFAULT_ENGINEER_LEVEL=Python使用可能な平均的エンジニア
DEFAULT_DEVELOPMENT_ENVIRONMENT=標準的な開発環境
DEFAULT_DATABASE_TABLES=20
DEFAULT_API_ENDPOINTS=50
DEFAULT_TEST_PAGES=1000
DEFAULT_TECH_STACK=React/Vue.js + Node.js/Python
```

## 🎮 使用方法

### 1. 基本的な使用

```bash
python main.py
```

### 2. デモ実行

```bash
python main.py --demo
```

### 3. サンプルExcelファイルの作成

```bash
python create_sample.py
```

## 📊 実行例

### 基本実行の流れ

```bash
$ python main.py
```

```
============================================================
🚀 DeliverableEstimate Pro - AI駆動成果物見積もり自動化システム
============================================================
✅ 設定確認完了
   - 人日単価: 50,000円
   - 税率: 10%
   - 通貨: JPY
   - 言語: ja
   - AIモデル: gpt-4o-mini

📄 Excelファイルのパス (例: input/sample_input.xlsx): input/sample_input.xlsx

📝 システム要件を入力してください:
   例: ECサイトの構築プロジェクト
       - ユーザー管理機能
       - 商品管理機能
       - 決済機能

入力してください (複数行可、空行で終了):
ECサイトの構築プロジェクト
- ユーザー管理機能（登録・認証・プロファイル）
- 商品管理機能（カタログ・在庫・検索）
- 決済機能（クレジットカード・履歴管理）
- 管理画面（ダッシュボード・分析）
- レスポンシブ対応
- セキュリティ要件（SSL・個人情報保護）

============================================================
🔄 見積処理を開始します...
============================================================
🚀 見積セッションを開始します (ID: 12345678-1234-1234-1234-123456789012)
📄 入力ファイル: input/sample_input.xlsx
📝 システム要件: ECサイトの構築プロジェクト...
🔄 入力データを処理中...
🔍 成果物を分析中...
⏱️ 工数を見積中...
❓ 精度向上のための質問を生成中...

❓ 見積精度向上のための質問
==================================================
より正確な見積のため、いくつか質問させていただきます。
不明な場合はEnterでデフォルト値を使用します。

質問 1/5:
データベース設計のデータベース設計で、必要なテーブル数はどれくらいですか？
影響: データベース設計工数に影響
デフォルト: 25
範囲: 1 - 100
回答: 30

質問 2/5:
API設計・実装でAPI設計・実装で必要なAPIエンドポイント数はどれくらいですか？
影響: API設計・開発工数に影響
デフォルト: 60
範囲: 1 - 200
回答: 80

質問 3/5:
フロントエンド開発でテスト対象となるページ数はどれくらいですか？
影響: テスト実装工数に影響
デフォルト: 50
範囲: 1 - 500
回答: 100

質問 4/5:
決済機能のセキュリティ要件レベルはどの程度ですか？
影響: セキュリティ実装工数に影響
選択肢: 基本, 標準, 高度
デフォルト: 標準
回答: 高度

質問 5/5:
バックエンド開発の想定同時利用者数はどれくらいですか？
影響: スケーラビリティ対応工数に影響
デフォルト: 1000
範囲: 1 - 10000
回答: 5000

💰 コストを計算中...
📊 見積書を生成中...

📊 見積書プレビュー
============================================================
📋 成果物別見積:
  要件定義書: 6.0人日 → 300,000円
  システム設計書: 10.4人日 → 520,000円
  データベース設計: 14.0人日 → 700,000円
  フロントエンド開発: 32.5人日 → 1,625,000円
  バックエンド開発: 39.0人日 → 1,950,000円
  API設計・実装: 26.0人日 → 1,300,000円
  ユーザー管理機能: 15.6人日 → 780,000円
  商品管理機能: 19.5人日 → 975,000円
  決済機能: 26.0人日 → 1,300,000円
  管理画面: 22.1人日 → 1,105,000円
  単体テスト: 13.0人日 → 650,000円
  結合テスト: 16.3人日 → 815,000円
  システムテスト: 19.5人日 → 975,000円
  運用マニュアル: 7.8人日 → 390,000円
  デプロイメント: 6.5人日 → 325,000円

🛠️ 技術前提条件:
  エンジニアレベル: Python使用可能な平均的エンジニア
  技術スタック: React/Vue.js + Node.js/Python
  データベーステーブル: 30テーブル
  APIエンドポイント: 80個
  テストページ: 100ページ

💰 財務サマリー:
  小計: 13,710,000円
  税額(10%): 1,371,000円
  総額: 15,081,000円
  総工数: 274.2人日

⚠️ リスクアラート:
  • 決済機能 (信頼度75%)
  • バックエンド開発 (信頼度78%)

📝 質問応答セッション:
  質問数: 5
  回答数: 5

🔍 見積書の確認をお願いします:

この見積書で問題ありませんか？
1. はい（Yes）- Excel出力して終了
2. いいえ（No）- 修正・調整が必要

選択（Y/N）: Y

✅ 見積書を出力しました: output/20250709-143500.xlsx

============================================================
✅ 見積処理が完了しました!
============================================================
📊 出力ファイル: output/20250709-143500.xlsx
📝 生成情報:
   - 生成時刻: 2025-07-09T14:35:00Z
   - 総行数: 28
   - データ行数: 15
   - 言語: ja
   - 通貨: JPY

👋 ご利用ありがとうございました
```

### 修正・調整が必要な場合

```
🔍 見積書の確認をお願いします:

この見積書で問題ありませんか？
1. はい（Yes）- Excel出力して終了
2. いいえ（No）- 修正・調整が必要

選択（Y/N）: N

修正したい項目を選択してください:

1. 成果物の追加・削除
2. 技術前提条件の変更
3. 工数調整
4. 価格調整
5. その他

修正内容を詳しく記入: 決済機能の工数を20人日に短縮してください

🔄 フィードバックを処理中...
🔍 成果物を分析中...
⏱️ 工数を見積中...
💰 コストを計算中...
📊 見積書を生成中...

📊 見積書プレビュー（修正版）
============================================================
📋 成果物別見積:
  決済機能: 20.0人日 → 1,000,000円
  [その他の成果物...]

💰 財務サマリー:
  小計: 13,410,000円
  税額(10%): 1,341,000円
  総額: 14,751,000円
  総工数: 268.2人日

🔍 見積書の確認をお願いします:

この見積書で問題ありませんか？
1. はい（Yes）- Excel出力して終了
2. いいえ（No）- 修正・調整が必要

選択（Y/N）: Y

✅ 見積書を出力しました: output/20250709-143512.xlsx
```

### デモ実行例

```bash
$ python main.py --demo
```

```
🎯 クイックデモを実行します
🚀 見積セッションを開始します (ID: demo-session-001)
📄 入力ファイル: input/sample_input.xlsx
📝 システム要件: ECサイトの構築プロジェクト...
🔄 入力データを処理中...
🔍 成果物を分析中...
⏱️ 工数を見積中...
❓ 精度向上のための質問を生成中...
[自動回答でスキップ...]
💰 コストを計算中...
📊 見積書を生成中...
[自動承認...]
✅ 見積書を出力しました: output/20250709-demo.xlsx
✅ デモ実行成功!
📊 出力ファイル: output/20250709-demo.xlsx
```

## 📁 入力ファイル形式

Excel形式（.xlsx）で以下の形式:

| A列: 成果物名 | B列: 説明 |
|---|---|
| 要件定義書 | システムの機能要件・非機能要件を詳細に記載した文書 |
| システム設計書 | システム全体のアーキテクチャ設計とコンポーネント設計 |
| データベース設計 | データベースのER図作成とテーブル設計 |
| フロントエンド開発 | React/Vue.jsを使用したユーザーインターフェースの実装 |
| バックエンド開発 | Node.js/Pythonを使用したサーバーサイドアプリケーション開発 |
| ... | ... |

## 📊 出力ファイル形式

元のExcelファイルにC列（工数）、D列（金額）、見積前提条件を追加:

| A列: 成果物名 | B列: 説明 | C列: 工数(人日) | D列: 金額(円) |
|---|---|---|---|
| 要件定義書 | システムの機能要件... | 6.0 | 300,000 |
| システム設計書 | システム全体の... | 10.4 | 520,000 |
| データベース設計 | データベースのER図... | 14.0 | 700,000 |
| ... | ... | ... | ... |
| **小計** | | **274.2** | **13,710,000** |
| **税額(10%)** | | | **1,371,000** |
| **総額** | | | **15,081,000** |
| | | | |
| **【見積前提条件】** | | | |
| エンジニアレベル | Python使用可能な平均的エンジニア | | |
| 人日単価 | 50,000 (JPY) | | |
| 技術スタック | React/Vue.js + Node.js/Python | | |
| データベーステーブル | 30テーブル想定 | | |
| APIエンドポイント | 80エンドポイント想定 | | |
| テストページ | 100ページ想定 | | |

## 🏗️ システム構成

```
deliverable_estimate_pro/
├── agents/              # 5つのエージェント
│   ├── __init__.py
│   ├── input_processor.py        # 入力処理・データ構造化
│   ├── deliverable_analyzer.py   # 成果物分析・複雑度評価
│   ├── effort_estimator.py       # 工数見積・リスク調整
│   ├── question_generator.py     # 精度向上質問生成
│   └── report_generator.py       # 見積書出力・承認管理
├── tools/               # ツール・ユーティリティ
│   ├── __init__.py
│   └── cost_calculator.py        # コスト算出（非AI）
├── hitl/               # Human-in-the-Loop
│   ├── __init__.py
│   └── feedback_processor.py     # フィードバック処理
├── config/             # 設定管理
│   ├── __init__.py
│   └── settings.py               # 環境設定管理
├── input/              # 入力ファイル
│   └── sample_input.xlsx         # サンプル入力ファイル
├── output/             # 出力ファイル
├── logs/               # ログファイル
├── specs/              # 仕様書
│   ├── project_overview.md
│   ├── system_architecture.md
│   ├── agent_specifications.md
│   ├── langgraph_implementation.md
│   └── hitl_design.md
├── workflow.py         # LangGraphワークフロー
├── main.py            # メインエントリーポイント
├── create_sample.py   # サンプルファイル作成
├── requirements.txt   # 依存関係
├── .env.example       # 環境設定テンプレート
└── README.md         # このファイル
```

## 🤖 技術詳細

### エージェント構成

1. **Input Processor**: Excel・要件テキスト・環境設定の読み込み
2. **Deliverable Analyzer**: 成果物の意味解析・複雑度・リスク評価
3. **Effort Estimator**: 工数算出・リスク調整・信頼度評価
4. **Question Generator**: 精度向上のための動的質問生成
5. **Report Generator**: 見積書表示・ユーザー承認・Excel出力

### Human-in-the-Loop

- **見積プレビュー**: コンソールでの見積結果表示
- **ユーザー承認**: 承認/修正の選択
- **フィードバック処理**: 修正内容の解析と適用
- **動的質問**: 不明確な要素の確認

### 技術スタック

- **LangGraph**: ワークフロー管理・状態管理
- **OpenAI API**: AI推論・自然言語処理
- **Pandas**: データ処理・Excel操作
- **OpenPyXL**: Excel読み書き
- **Python-dotenv**: 環境設定管理

## ⚙️ 設定オプション

### 環境変数

| 変数名 | 説明 | デフォルト値 |
|---|---|---|
| `OPENAI_API_KEY` | OpenAI APIキー | 必須 |
| `DAILY_RATE` | 人日単価 | 50000 |
| `TAX_RATE` | 税率 | 0.10 |
| `CURRENCY` | 通貨単位 | JPY |
| `LANGUAGE` | 言語設定 | ja |
| `MODEL` | 使用するAIモデル | gpt-4o-mini |

### デフォルト技術前提

| 項目 | デフォルト値 |
|---|---|
| エンジニアレベル | Python使用可能な平均的エンジニア |
| 開発環境 | 標準的な開発環境 |
| データベーステーブル | 20テーブル |
| APIエンドポイント | 50エンドポイント |
| テストページ | 1000ページ |
| 技術スタック | React/Vue.js + Node.js/Python |

## 🔧 トラブルシューティング

### よくある問題

#### 1. APIキーエラー

```
❌ エラー: OPENAI_API_KEYが設定されていません
```

**解決方法**: `.env`ファイルのOPENAI_API_KEYを確認してください

#### 2. ファイルが見つからない

```
❌ エラー: ファイルが見つかりません: input/sample_input.xlsx
```

**解決方法**: 
```bash
python create_sample.py  # サンプルファイルを作成
```

#### 3. 依存関係エラー

```
ImportError: No module named 'langgraph'
```

**解決方法**: 
```bash
pip install -r requirements.txt
```

#### 4. NumPy互換性エラー

```
ValueError: numpy.dtype size changed, may indicate binary incompatibility
```

**解決方法**: 
```bash
pip install --upgrade numpy pandas
```

### ログ確認

```bash
# ログファイルの確認
tail -f logs/estimation.log

# 詳細なデバッグログ
export LOG_LEVEL=DEBUG
python main.py
```

## 📈 パフォーマンス指標

### 期待される成果

- **見積作業時間**: 70%削減
- **見積精度**: 実工数乖離率 < 15%
- **ユーザー承認率**: > 90%
- **処理時間**: 基本見積完了 < 30分

### システム制限

- **最大成果物数**: 100件
- **同時セッション数**: 5セッション
- **メモリ使用量**: < 2GB

## 🧪 開発者向け情報

### テスト実行

```bash
# 全テスト実行
python -m pytest tests/

# 特定のテスト実行
python -m pytest tests/test_agents.py

# カバレッジ付きテスト
python -m pytest --cov=agents tests/
```

### 新しいエージェントの追加

1. `agents/`ディレクトリに新しいエージェントクラスを作成
2. `workflow.py`にノードを追加
3. 必要に応じて`EstimationState`の定義を更新

### カスタマイズ例

```python
# 新しい複雑度評価アルゴリズムの追加
class CustomComplexityEvaluator:
    def evaluate(self, deliverable):
        # カスタムロジック
        return complexity_score

# エージェントに統合
analyzer = DeliverableAnalyzer()
analyzer.complexity_evaluator = CustomComplexityEvaluator()
```

## 📄 ライセンス

MIT License

## 👥 作成者

Ready Tensor AAIDC Module2 プロジェクト

## 🙏 謝辞

このプロジェクトは以下の技術・ライブラリを使用しています：

- **LangGraph**: ワークフロー管理
- **OpenAI**: AI推論エンジン
- **Pandas**: データ処理
- **OpenPyXL**: Excel操作

## 📚 参考資料

- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [OpenAI API Reference](https://platform.openai.com/docs/api-reference)
- [Pandas Documentation](https://pandas.pydata.org/docs/)

---

**更新日**: 2025年7月9日  
**バージョン**: 1.0  
**対象**: Ready Tensor AAIDC Module2 プロジェクト